from Mbal_fP import Mbal_fP
from fQ import fQ
from Pust import Pust
from Kom_power import Kom_power

def calc(Pn, Tn, Zn, G, Gp, Cf, Cw, k, m, R, H, Tj, alfa, visc_w, Swi,
         ZCOR, Pkri, Tkri,
         A, b,
         d, Lk, Ro, L, Tust_val, Tzab, VCOR, DCOR, LCOR, Ld_tab,
         Qg_mln,
         z_data=None, z_pressures=None,
         rho_data=None, rho_pressures=None,
         visc_data=None, visc_pressures=None,
         ld_data=None, ld_pressures=None):
    """
    Главная управляющая функция расчёта.

    Возвращает:
    - словарь с P (пластовое давление), Q (дебит), Pуст, Nk
    """
    # 1. Расчёт пластового давления
    P = Mbal_fP(Pn, Tn, Zn, G, Gp, Cf, Cw, k, m, R, H, Tj, alfa, visc_w, Swi,
                ZCOR, Pkri, Tkri, Qg_mln * 1000, d, Ro)

    # 2. Расчёт дебита
    Q = fQ(A, b, P, Pn)

    # 3. Устьевое давление
    Pust_val = Pust(P, Q, d, Lk, Ro, L, Tust_val, Tzab,
                    ZCOR, VCOR, DCOR, LCOR, Ld_tab,
                    Pkri, Tkri, m,
                    z_data, z_pressures,
                    rho_data, rho_pressures,
                    visc_data, visc_pressures,
                    ld_data, ld_pressures)

    # 4. Мощность компрессора
    Nk = Kom_power(Qg_mln, Pust_val, Tust_val, Pn, ZCOR, Pkri, Tkri)

    return {
        "P": P,
        "Q": Q,
        "Pust": Pust_val,
        "Nk": Nk
    }
